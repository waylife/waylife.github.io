
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Android桌面快捷方式那些事与那些坑 | RxRead&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="RxRead">
    
    <meta name="description" content="将近二个多月没写博客了。之前一段时间一直在搞红包助手，就没抽时间写博客，但写这个真的是很好玩。没想到居然在Android上实现模拟点击，从而实现自动抢红包，有兴趣的同学可以参考https://github.com/waylife/RedEnvelopeAssistant ,代码已经开源。红包助手还有">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="waylife365" />
    <meta name="twitter:title" content="Android桌面快捷方式那些事与那些坑 | RxRead&#39;s Blog" />
      
    
    
    <link rel="alternate" href="/rss.xml" title="RxRead&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="RxRead&#39;s Blog" title="RxRead&#39;s Blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="RxRead&#39;s Blog">RxRead&#39;s Blog</a></h1>
				<h2 class="blog-motto">关注Android、WP、Java、C#、自我认知、程序安全等</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
						<li><a href="/resume">Resume</a></li>
					
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" autocomplete="off" name="q" maxlength="20" placeholder="搜索" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/14/android-shortcut-summary/" title="Android桌面快捷方式那些事与那些坑" itemprop="url">Android桌面快捷方式那些事与那些坑</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://blog.zanlabs.com" title="RxRead">RxRead</a>
    </p>
  <p class="article-time">
    <time datetime="2015-03-14T08:22:45.000Z" itemprop="datePublished">3月 14 2015</time>
    更新日期:<time datetime="2015-03-14T14:07:01.000Z" itemprop="dateModified">3月 14 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#增加快捷方式"><span class="toc-number">2.1.</span> <span class="toc-text">增加快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除快捷方式"><span class="toc-number">2.2.</span> <span class="toc-text">删除快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快捷方式修改"><span class="toc-number">2.3.</span> <span class="toc-text">快捷方式修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快捷方式存在判断"><span class="toc-number">2.4.</span> <span class="toc-text">快捷方式存在判断</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#兼容与注意事项"><span class="toc-number">3.</span> <span class="toc-text">兼容与注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#兼容"><span class="toc-number">3.1.</span> <span class="toc-text">兼容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项"><span class="toc-number">3.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">5.</span> <span class="toc-text">附录</span></a></li></ol>
		</div>
		
		<p>将近二个多月没写博客了。<br>之前一段时间一直在搞红包助手，就没抽时间写博客，但写这个真的是很好玩。没想到居然在Android上实现模拟点击，从而实现自动抢红包，有兴趣的同学可以参考<a href="https://github.com/waylife/RedEnvelopeAssistant" target="_blank" rel="external">https://github.com/waylife/RedEnvelopeAssistant</a> ,代码已经开源。<br>红包助手还有一些问题，但是现在基本的抢红包基本没问题了。目前正在对它进行优化以及较低版本的一些适配，还有项目的国际化工作。<br>废话不多说了，下面是Andrioid开发过程中快捷方式相关的事与坑。<br>数据来源于上次组内自己的CodeReview总结。</p>
<h1 id="背景">背景</h1>
<p>一般情况下，为了让用户更方便的打开应用，程序会在桌面上生成一些快捷方式。<br>本来呢，如果是原生的桌面，其实是十分简单，直接调用系统相关的API就行了。但是众多的系统厂商以及众多第三方自己定制的桌面（Launcher），导致在适配、兼容方面存在很多问题。<br>比如，有些桌面无法删除快捷方式（比如小米），有些桌面无法生成快捷方式（比如锤子），有些系统无法更新桌面图标（比如华为荣耀6）。<br>在升级、降级的时候快捷方式发生变化；比如，全部变成应用的主图标，升级、降级后点击快捷方式没有反应，删除应用后无法删除快捷方式。<br>很多问题都是需要解决的，虽然有些由于系统限制，没有办法搞定所有的，但是仍然需要寻求一个最优的方案。这也就是本文需要讨论的问题。<br>本文说指的快捷方式是指应用桌面快捷方式，不包含长按弹出的生成快捷方式。<br>快捷方式所有信息都是存在于launcher的favorite表。一般需要用到的字段为_id,title,intent,iconResource,icon，分别表示 快捷方式名称，快捷方式intent，快捷方式图标（本地），快捷方式图标（data二进制压缩数据）。<br>两个intent数据如下<br><img src="https://github.com/waylife/blogimage/raw/master/2015/03/14/shorcut_intent.png" alt=" "><br>数据可以通过SQLite Editor查看，需要已经ROOT的手机  </p>
<h1 id="实现">实现</h1>
<h2 id="增加快捷方式">增加快捷方式</h2>
<p>在AndroidManifest.xml增加权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.INSTALL_SHORTCUT"</span> /&gt;</div></pre></td></tr></table></figure>

<p>同时，根据Intent是隐式还是显示在相关的Activity声明相关的intent-filter。<br>相关代码：<br><img src="https://github.com/waylife/blogimage/raw/master/2015/03/14/shortcut_add.jpg" alt=" "><br><img src="https://github.com/waylife/blogimage/raw/master/2015/03/14/shortcut_add_2.jpg" alt=" "></p>
<h2 id="删除快捷方式">删除快捷方式</h2>
<p>跟增加快捷方式一样，也是需要增加权限的。加上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.UNINSTALL_SHORTCUT"</span> /&gt;</div></pre></td></tr></table></figure>

<p>相关代码：<br><img src="https://github.com/waylife/blogimage/raw/master/2015/03/14/shortcut_delete.jpg" alt=" "></p>
<h2 id="快捷方式修改">快捷方式修改</h2>
<p>需要增加权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">&lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div></pre></td></tr></table></figure>

<p>如果适配所有桌面，请添加附录中第二条所列出的权限。<br>系统并没有提供API去更改桌面快捷方式。只能通过其他猥琐的办法了，可行的的办法之一就是通过ContentProvider去更改数据库相关的信息。当然有人会说了，先删掉快捷方式，再重新创建不就行了？这是个办法。但是有些系统是无法删除快捷方式的；另外，删除快捷方式与创建快捷方式都是通过广播实现的，这个地方需要控制两者的时间间隔。权衡之后，选用第一种办法相对稳妥。<br>废话不多少，上代码。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="javadoc">/**</span></div><div class="line">  * 更新桌面快捷方式图标，不一定所有图标都有效&lt;br/&gt;</div><div class="line">  * 如果快捷方式不存在，则不更新&lt;br/&gt;.</div><div class="line">  */</div><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">updateShortcutIcon</span>(Context context, String title, Intent intent,Bitmap bitmap) {</div><div class="line">  <span class="keyword">if</span>(bitmap==<span class="keyword">null</span>){</div><div class="line">   XLog.i(TAG, <span class="string">"update shortcut icon,bitmap empty"</span>);</div><div class="line">   <span class="keyword">return</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">try</span>{</div><div class="line">   <span class="keyword">final</span> ContentResolver cr = context.getContentResolver();</div><div class="line">   StringBuilder uriStr = <span class="keyword">new</span> StringBuilder();</div><div class="line">   String urlTemp=<span class="string">""</span>;</div><div class="line">   String authority = LauncherUtil.getAuthorityFromPermissionDefault(context);</div><div class="line">   <span class="keyword">if</span>(authority==<span class="keyword">null</span>||authority.trim().equals(<span class="string">""</span>)){</div><div class="line">    authority = LauncherUtil.getAuthorityFromPermission(context,LauncherUtil.getCurrentLauncherPackageName(context)+<span class="string">".permission.READ_SETTINGS"</span>);</div><div class="line">   }</div><div class="line">   uriStr.append(<span class="string">"content://"</span>);</div><div class="line">   <span class="keyword">if</span> (TextUtils.isEmpty(authority)) {</div><div class="line">    <span class="keyword">int</span> sdkInt = android.os.Build.VERSION.SDK_INT;</div><div class="line">    <span class="keyword">if</span> (sdkInt &lt; <span class="number">8</span>) { <span class="comment">// Android 2.1.x(API 7)以及以下的</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sdkInt &lt; <span class="number">19</span>) {<span class="comment">// Android 4.4以下</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher2.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> {<span class="comment">// 4.4以及以上</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher3.settings"</span>);</div><div class="line">    }</div><div class="line">   } <span class="keyword">else</span> {</div><div class="line">    uriStr.append(authority);</div><div class="line">   }</div><div class="line">   urlTemp=uriStr.toString();</div><div class="line">   uriStr.append(<span class="string">"/favorites?notify=true"</span>);</div><div class="line">   Uri uri = Uri.parse(uriStr.toString());</div><div class="line">   Cursor c = cr.query(uri, <span class="keyword">new</span> String[] {<span class="string">"_id"</span>, <span class="string">"title"</span>, <span class="string">"intent"</span> },</div><div class="line">     <span class="string">"title=?  and intent=? "</span>,</div><div class="line">     <span class="keyword">new</span> String[] { title, intent.toUri(<span class="number">0</span>) }, <span class="keyword">null</span>);</div><div class="line">   <span class="keyword">int</span> index=-<span class="number">1</span>;</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && c.getCount() &gt; <span class="number">0</span>) {</div><div class="line">    c.moveToFirst();</div><div class="line">    index=c.getInt(<span class="number">0</span>);<span class="comment">//获得图标索引</span></div><div class="line">    ContentValues cv=<span class="keyword">new</span> ContentValues();</div><div class="line">    cv.put(<span class="string">"icon"</span>, flattenBitmap(bitmap));</div><div class="line">    Uri uri2=Uri.parse(urlTemp+<span class="string">"/favorites/"</span>+index+<span class="string">"?notify=true"</span>);</div><div class="line">    <span class="keyword">int</span> i=context.getContentResolver().update(uri2, cv, <span class="keyword">null</span>,<span class="keyword">null</span>);</div><div class="line">    context.getContentResolver().notifyChange(uri,<span class="keyword">null</span>);<span class="comment">//此处不能用uri2，是个坑</span></div><div class="line">    XLog.i(TAG, <span class="string">"update ok: affected "</span>+i+<span class="string">" rows,index is"</span>+index);</div><div class="line">   }<span class="keyword">else</span>{</div><div class="line">    XLog.i(TAG, <span class="string">"update result failed"</span>);</div><div class="line">   }</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && !c.isClosed()) {</div><div class="line">    c.close();</div><div class="line">   }</div><div class="line">  }<span class="keyword">catch</span>(Exception ex){</div><div class="line">   ex.printStackTrace();</div><div class="line">   XLog.i(TAG, <span class="string">"update shortcut icon,get errors:"</span>+ex.getMessage());</div><div class="line">  }</div><div class="line"> }</div><div class="line"></div><div class="line"></div><div class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] <span class="title">flattenBitmap</span>(Bitmap bitmap) {</div><div class="line">  <span class="comment">// Try go guesstimate how much space the icon will take when serialized</span></div><div class="line">  <span class="comment">// to avoid unnecessary allocations/copies during the write.</span></div><div class="line">  <span class="keyword">int</span> size = bitmap.getWidth() * bitmap.getHeight() * <span class="number">4</span>;</div><div class="line">  ByteArrayOutputStream out = <span class="keyword">new</span> ByteArrayOutputStream(size);</div><div class="line">  <span class="keyword">try</span> {</div><div class="line">   bitmap.compress(Bitmap.CompressFormat.PNG, <span class="number">100</span>, out);</div><div class="line">   out.flush();</div><div class="line">   out.close();</div><div class="line">   <span class="keyword">return</span> out.toByteArray();</div><div class="line">  } <span class="keyword">catch</span> (IOException e) {</div><div class="line">   XLog.w(TAG, <span class="string">"Could not write icon"</span>);</div><div class="line">   <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">  }</div><div class="line"> }</div></pre></td></tr></table></figure>

<h2 id="快捷方式存在判断">快捷方式存在判断</h2>
<p>需要增加的权限同修改快捷方式<br>虽然说通过SharePreference来保证快捷方式不会重复创建，以及通过shortcutIntent.putExtra(“duplicate”, false)也可以确保，但是为了万无一失，还是可以通过去查询数据判断快捷方式是否存在，来避免重复创建。   代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="javadoc">/**</span></div><div class="line">  * 检查快捷方式是否存在 &lt;br/&gt;</div><div class="line">  * &lt;font color=red&gt;注意：&lt;/font&gt; 有些手机无法判断是否已经创建过快捷方式&lt;br/&gt;</div><div class="line">  * 因此，在创建快捷方式时，请添加&lt;br/&gt;</div><div class="line">  * shortcutIntent.putExtra("duplicate", false);// 不允许重复创建&lt;br/&gt;</div><div class="line">  * 最好使用{@link #isShortCutExist(Context, String, Intent)}</div><div class="line">  * 进行判断，因为可能有些应用生成的快捷方式名称是一样的的&lt;br/&gt;</div><div class="line">  * 此处需要在AndroidManifest.xml中配置相关的桌面权限信息&lt;br/&gt;</div><div class="line">  * 错误信息已捕获&lt;br/&gt;</div><div class="line">  */</div><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isShortCutExist</span>(Context context, String title) {</div><div class="line">  <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">try</span> {</div><div class="line">   <span class="keyword">final</span> ContentResolver cr = context.getContentResolver();</div><div class="line">   StringBuilder uriStr = <span class="keyword">new</span> StringBuilder();</div><div class="line">   String authority = LauncherUtil.getAuthorityFromPermissionDefault(context);</div><div class="line">   <span class="keyword">if</span>(authority==<span class="keyword">null</span>||authority.trim().equals(<span class="string">""</span>)){</div><div class="line">    authority = LauncherUtil.getAuthorityFromPermission(context,LauncherUtil.getCurrentLauncherPackageName(context)+<span class="string">".permission.READ_SETTINGS"</span>);</div><div class="line">   }</div><div class="line">   uriStr.append(<span class="string">"content://"</span>);</div><div class="line">   <span class="keyword">if</span> (TextUtils.isEmpty(authority)) {</div><div class="line">    <span class="keyword">int</span> sdkInt = android.os.Build.VERSION.SDK_INT;</div><div class="line">    <span class="keyword">if</span> (sdkInt &lt; <span class="number">8</span>) { <span class="comment">// Android 2.1.x(API 7)以及以下的</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sdkInt &lt; <span class="number">19</span>) {<span class="comment">// Android 4.4以下</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher2.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> {<span class="comment">// 4.4以及以上</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher3.settings"</span>);</div><div class="line">    }</div><div class="line">   } <span class="keyword">else</span> {</div><div class="line">    uriStr.append(authority);</div><div class="line">   }</div><div class="line">   uriStr.append(<span class="string">"/favorites?notify=true"</span>);</div><div class="line">   Uri uri = Uri.parse(uriStr.toString());</div><div class="line">   Cursor c = cr.query(uri, <span class="keyword">new</span> String[] { <span class="string">"title"</span> },</div><div class="line">     <span class="string">"title=? "</span>,</div><div class="line">     <span class="keyword">new</span> String[] { title }, <span class="keyword">null</span>);</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && c.getCount() &gt; <span class="number">0</span>) {</div><div class="line">    result = <span class="keyword">true</span>;</div><div class="line">   }</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && !c.isClosed()) {</div><div class="line">    c.close();</div><div class="line">   }</div><div class="line">  } <span class="keyword">catch</span> (Exception e) {</div><div class="line">   e.printStackTrace();</div><div class="line">   result=<span class="keyword">false</span>;</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line"> }</div><div class="line"></div><div class="line"> <span class="javadoc">/**</span></div><div class="line">  * 不一定所有的手机都有效，因为国内大部分手机的桌面不是系统原生的&lt;br/&gt;</div><div class="line">  * 更多请参考{@link #isShortCutExist(Context, String)}&lt;br/&gt;</div><div class="line">  * 桌面有两种，系统桌面(ROM自带)与第三方桌面，一般只考虑系统自带&lt;br/&gt;</div><div class="line">  * 第三方桌面如果没有实现系统响应的方法是无法判断的，比如GO桌面&lt;br/&gt;</div><div class="line">  * 此处需要在AndroidManifest.xml中配置相关的桌面权限信息&lt;br/&gt;</div><div class="line">  * 错误信息已捕获&lt;br/&gt;</div><div class="line">  */</div><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isShortCutExist</span>(Context context, String title, Intent intent) {</div><div class="line">  <span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">  <span class="keyword">try</span>{</div><div class="line">   <span class="keyword">final</span> ContentResolver cr = context.getContentResolver();</div><div class="line">   StringBuilder uriStr = <span class="keyword">new</span> StringBuilder();</div><div class="line">   String authority = LauncherUtil.getAuthorityFromPermissionDefault(context);</div><div class="line">   <span class="keyword">if</span>(authority==<span class="keyword">null</span>||authority.trim().equals(<span class="string">""</span>)){</div><div class="line">    authority = LauncherUtil.getAuthorityFromPermission(context,LauncherUtil.getCurrentLauncherPackageName(context)+<span class="string">".permission.READ_SETTINGS"</span>);</div><div class="line">   }</div><div class="line">   uriStr.append(<span class="string">"content://"</span>);</div><div class="line">   <span class="keyword">if</span> (TextUtils.isEmpty(authority)) {</div><div class="line">    <span class="keyword">int</span> sdkInt = android.os.Build.VERSION.SDK_INT;</div><div class="line">    <span class="keyword">if</span> (sdkInt &lt; <span class="number">8</span>) { <span class="comment">// Android 2.1.x(API 7)以及以下的</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (sdkInt &lt; <span class="number">19</span>) {<span class="comment">// Android 4.4以下</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher2.settings"</span>);</div><div class="line">    } <span class="keyword">else</span> {<span class="comment">// 4.4以及以上</span></div><div class="line">     uriStr.append(<span class="string">"com.android.launcher3.settings"</span>);</div><div class="line">    }</div><div class="line">   } <span class="keyword">else</span> {</div><div class="line">    uriStr.append(authority);</div><div class="line">   }</div><div class="line">   uriStr.append(<span class="string">"/favorites?notify=true"</span>);</div><div class="line">   Uri uri = Uri.parse(uriStr.toString());</div><div class="line">   Cursor c = cr.query(uri, <span class="keyword">new</span> String[] { <span class="string">"title"</span>, <span class="string">"intent"</span> },</div><div class="line">     <span class="string">"title=?  and intent=?"</span>,</div><div class="line">     <span class="keyword">new</span> String[] { title, intent.toUri(<span class="number">0</span>) }, <span class="keyword">null</span>);</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && c.getCount() &gt; <span class="number">0</span>) {</div><div class="line">    result = <span class="keyword">true</span>;</div><div class="line">   }</div><div class="line">   <span class="keyword">if</span> (c != <span class="keyword">null</span> && !c.isClosed()) {</div><div class="line">    c.close();</div><div class="line">   }</div><div class="line">  }<span class="keyword">catch</span>(Exception ex){</div><div class="line">   result=<span class="keyword">false</span>;</div><div class="line">   ex.printStackTrace();</div><div class="line">  }</div><div class="line">  <span class="keyword">return</span> result;</div><div class="line"> }</div></pre></td></tr></table></figure>

<h1 id="兼容与注意事项">兼容与注意事项</h1>
<h2 id="兼容">兼容</h2>
<p>所有的快捷方式Intent如果不是之前版本的存在很大问题，绝对不要改变参数，否则升级或者降级时快捷方式会出现问题；<br>同时，尽可能的采用隐式调用，自定义CATEGORY，而不是自定义ACTION，ACTION参数一定要为ACTION_MAIN，否则有些手机在卸载时无法删除快捷方式（WTF）。</p>
<h2 id="注意事项">注意事项</h2>
<ul>
<li>【所有】activity路径的变更导致老版本升级之后快捷方式无法使用<br>—&gt; 1.一旦使用确定了activity的包路径，之后就不要再变更；<br>—&gt; 2.尽可能使用隐式调用，但是如果之前已经发出去的版本，为了兼容性，就必须一直使用老的方式，新版本的尽可能的不要更改方式，如果用户降级，老版本快捷方式会无法使用。  </li>
<li>【部分】多个快捷方式指向一个activity导致部分手机（三星SII）升级时图标变成应用图标<br>—&gt; 尽可能的避免多个快捷方式指向同一个activity，可能通过多个activity再跳转过去  </li>
<li>【部分】应用删除时无法删除快捷方式。与系统桌面Launcher实现有关。<br>—&gt; 为了适配所有Launcher，Intent Action使用Intent.ACTION_MAIN。如果是隐式调用，尽可能自定义CATEGORY，而不是自定义ACTION。  </li>
<li>【部分】应用升级时需要删除老版本部分快捷方式，但是部分手机无法删除<br>—&gt; 无解  </li>
<li>【部分】第三方桌面无法生成、删除、更新快捷方式<br>—&gt; 呵呵，一般来说生成没有问题，但是删除，更新大部分桌面会有问题。尽可能避免这些操作。或者专门适配该桌面，成本较高。  </li>
<li>【部分】部分桌面无法实时更新图标，需要重启<br>—&gt; 无解，尝试过重启Launcher，但是结果是之前的快捷方式也消失了。只有重启手机，按理来说应该是有方式触发Launcher进行刷新的。<br>以上【所有】【部分】，分别表示必定出现，部分出现。  </li>
</ul>
<h1 id="参考">参考</h1>
<ol>
<li><a href="http://grepcode.com/search/?query=InstallShortcutReceiver" target="_blank" rel="external">http://grepcode.com/search/?query=InstallShortcutReceiver</a></li>
<li><a href="http://developer.android.com/index.html" target="_blank" rel="external">http://developer.android.com/index.html</a></li>
</ol>
<h1 id="附录">附录</h1>
<ol>
<li>完整代码可参考<br><a href="https://gist.github.com/waylife/437a3d98a84f245b9582" target="_blank" rel="external">https://gist.github.com/waylife/437a3d98a84f245b9582</a></li>
<li>通用更新快捷方式权限列表</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher2.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher2.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher3.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.launcher3.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adw.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adw.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.htc.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.htc.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.qihoo360.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.qihoo360.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.lge.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.lge.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"net.qihoo.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"net.qihoo.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adwfreak.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adwfreak.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adw.launcher_donut.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"org.adw.launcher_donut.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.launcher3.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.launcher3.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.fede.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.fede.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.sec.android.app.twlauncher.settings.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.sec.android.app.twlauncher.settings.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.anddoes.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.anddoes.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.tencent.qqlauncher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.tencent.qqlauncher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.launcher2.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.launcher2.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.mylauncher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.android.mylauncher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.ebproductions.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.ebproductions.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.oppo.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.oppo.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.android.launcher.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"com.huawei.android.launcher.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"telecom.mdesk.permission.READ_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"telecom.mdesk.permission.WRITE_SETTINGS"</span> /&gt;</div><div class="line">    &lt;uses-permission android:name=<span class="string">"dianxin.permission.ACCESS_LAUNCHER_DATA"</span> /&gt;</div></pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/shortcut/">shortcut</a><a href="/tags/快捷方式/">快捷方式</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Android/">Android</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://blog.zanlabs.com/2015/03/14/android-shortcut-summary/" data-title="Android桌面快捷方式那些事与那些坑 | RxRead&#39;s Blog" data-tsina="723678706" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/01/02/add-resume-type-to-hexo-under-pacman-theme/"  title="Pacman主题下给Hexo增加简历类型">
 <strong>NEXT:</strong><br/> 
 <span>Pacman主题下给Hexo增加简历类型
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#背景"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#实现"><span class="toc-number">2.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#增加快捷方式"><span class="toc-number">2.1.</span> <span class="toc-text">增加快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除快捷方式"><span class="toc-number">2.2.</span> <span class="toc-text">删除快捷方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快捷方式修改"><span class="toc-number">2.3.</span> <span class="toc-text">快捷方式修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#快捷方式存在判断"><span class="toc-number">2.4.</span> <span class="toc-text">快捷方式存在判断</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#兼容与注意事项"><span class="toc-number">3.</span> <span class="toc-text">兼容与注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#兼容"><span class="toc-number">3.1.</span> <span class="toc-text">兼容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意事项"><span class="toc-number">3.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">5.</span> <span class="toc-text">附录</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  <div class="rsspart">
	<a href="/rss.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Android/" title="Android">Android<sup>2</sup></a></li>
		
			<li><a href="/categories/Python/" title="Python">Python<sup>1</sup></a></li>
		
			<li><a href="/categories/Web/" title="Web">Web<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>2</sup></a></li>
		
			<li><a href="/tags/Python/" title="Python">Python<sup>1</sup></a></li>
		
			<li><a href="/tags/Web/" title="Web">Web<sup>1</sup></a></li>
		
			<li><a href="/tags/shortcut/" title="shortcut">shortcut<sup>1</sup></a></li>
		
			<li><a href="/tags/快捷方式/" title="快捷方式">快捷方式<sup>1</sup></a></li>
		
			<li><a href="/tags/技术/" title="技术">技术<sup>1</sup></a></li>
		
			<li><a href="/tags/爬虫/" title="爬虫">爬虫<sup>1</sup></a></li>
		
			<li><a href="/tags/网页/" title="网页">网页<sup>1</sup></a></li>
		
			<li><a href="/tags/网页抓取/" title="网页抓取">网页抓取<sup>1</sup></a></li>
		
			<li><a href="/tags/网页调起应用/" title="网页调起应用">网页调起应用<sup>1</sup></a></li>
		
			<li><a href="/tags/自定义协议/" title="自定义协议">自定义协议<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://zh.lucida.me/" target="_blank" >Lucida</a></li>
      <li><a href="http://coolshell.cn/" target="_blank" >酷壳</a></li>
      <li><a href="http://yinwang.org/" target="_blank" >王垠</a></li>
      <li><a href="http://www.trinea.cn/" target="_blank" >Trinea</a></li>
      <li><a href="http://blog.csdn.net/luoshengyang" target="_blank" >老罗的Android之旅</a></li>
      <li><a href="http://hexo.io" target="_blank" >Hexo</a></li>
    </ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Android 攻城师一枚 <br/>
			about Android,Java.etc</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/waylife365" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/waylife365" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/waylife" target="_blank" title="github"></a>
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://blog.zanlabs.com" target="_blank" title="RxRead">RxRead</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"rxreadblog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>


<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-56165343-2', 'blog.zanlabs.com');  
ga('send', 'pageview');
</script>


  </body>
</html>

